{% extends "base/base.html" %}

{% block title %}登录页面{% endblock %}

{% block login %}
    <style type="text/css">
        .container {
            padding-right: 35px;
            padding-left: 15px;
            margin-right: auto;
            margin-left: auto;
        }

        .login {
            width: 18%;
            margin-left: 550px;
            margin-right: auto;
        }

        input {
            width:: 10%;
        }
    </style>
    <script>
        //  ajax 刷新验证码
        $(function () {
            $('.captcha').css({
                'cursor': 'pointer'
            })
            // ajax 刷新
            $('.captcha').click(function () {
                console.log('click');
                $.getJSON("/captcha/refresh/",
                        function (result) {
                            $('.captcha').attr('src', result['image_url']);
                            $('#id_captcha_0').val(result['key'])
                        });
            });
            // ajax动态验证
            $('#id_captcha_1').blur(function () {  // #id_captcha_1为输入框的id，当该输入框失去焦点是触发函数
                json_data = {
                    'response': $('#id_captcha_1').val(),  // 获取输入框和隐藏字段id_captcha_0的数值
                    'hashkey': $('#id_captcha_0').val()
                }
                $.getJSON('/ajax_val', json_data, function (data) { //ajax发送
                    $('#captcha_status').remove()
                    if (data['status']) { //status返回1为验证码正确， status返回0为验证码错误， 在输入框的后面写入提示信息
                        $('#id_captcha_1').after('<span id="captcha_status" style="color:blue">*验证码正确</span>')
                    } else {
                        $('#id_captcha_1').after('<span id="captcha_status" style="color:red">*验证码错误</span>')
                    }
                });
            });
        })
    </script>
    <div class='login'>
        <form method="post" action="/login">{% csrf_token %}
            {% for field in form %}
                <div class="form-group">
                    <label>{{ field.label }}</label>
                    {{ field }}
                </div>
            {% endfor %}

            {% if login_mess %}
                <p style="color: red;">{{ login_mess }}</p>
            {% endif %}
            <div class="checkbox">
                <label>
                    <input type="checkbox"> 记住密码
                </label>
            </div>
            <button type="submit" class="btn btn-default" style="padding-right:50px;margin-right:35px;">登录</button>
            <a class="btn btn-default" href="/reg" role="button" style="padding-right:50px;">注册</a>
        </form>
    </div>
{% endblock %}
